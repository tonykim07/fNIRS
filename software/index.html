<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Sensor Group Activation Plots</title>
  <!-- Load Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <!-- Load Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      background-color: #f5f5f5;
    }
    .graph-container {
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .graph-title {
      text-align: center;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .toggle-button {
      margin-bottom: 20px;
    }
    /* Adjust styling for tabbed mode */
    .nav-tabs {
      margin-bottom: 15px;
      border-bottom: none;
    }
    .nav-tabs .nav-link {
      border: none;
      border-bottom: 2px solid transparent;
      color: #555;
      font-weight: bold;
      padding: 10px 15px;
    }
    .nav-tabs .nav-link.active {
      border-bottom: 2px solid #007bff;
      color: #007bff;
      background-color: #fff;
    }
    /* Ensure the tab content container doesn't overflow */
    .tab-pane.graph-container {
      height: 400px !important;
      overflow: hidden;
      padding: 0; /* Remove extra padding if needed */
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mt-4 mb-4 text-center">Sensor Group Activation Plots</h1>
    
    <!-- Toggle Button -->
    <div class="text-center">
      <button id="toggleMode" class="btn btn-primary toggle-button">Switch to Collapsed Mode</button>
    </div>
    
    <!-- Expanded Mode: Grid Layout -->
    <div id="expanded-container">
      <div class="row">
        <div class="col-md-6 graph-container" id="group1-container">
          <div id="group1" style="height: 400px;"></div>
        </div>
        <div class="col-md-6 graph-container" id="group2-container">
          <div id="group2" style="height: 400px;"></div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 graph-container" id="group3-container">
          <div id="group3" style="height: 400px;"></div>
        </div>
        <div class="col-md-6 graph-container" id="group4-container">
          <div id="group4" style="height: 400px;"></div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 graph-container" id="group5-container">
          <div id="group5" style="height: 400px;"></div>
        </div>
        <div class="col-md-6 graph-container" id="group6-container">
          <div id="group6" style="height: 400px;"></div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 graph-container" id="group7-container">
          <div id="group7" style="height: 400px;"></div>
        </div>
        <div class="col-md-6 graph-container" id="group8-container">
          <div id="group8" style="height: 400px;"></div>
        </div>
      </div>
    </div>
    
    <!-- Collapsed Mode: Tabbed Layout -->
    <div id="collapsed-container" style="display: none;">
      <ul class="nav nav-tabs" id="groupTabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" id="tab1-tab" data-toggle="tab" href="#tab1" role="tab">S1</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab2-tab" data-toggle="tab" href="#tab2" role="tab">S2</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab3-tab" data-toggle="tab" href="#tab3" role="tab">S3</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab4-tab" data-toggle="tab" href="#tab4" role="tab">S4</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab5-tab" data-toggle="tab" href="#tab5" role="tab">S5</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab6-tab" data-toggle="tab" href="#tab6" role="tab">S6</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab7-tab" data-toggle="tab" href="#tab7" role="tab">S7</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab8-tab" data-toggle="tab" href="#tab8" role="tab">S8</a>
        </li>
      </ul>
      <div class="tab-content" id="groupTabsContent">
        <div class="tab-pane fade show active graph-container" id="tab1" role="tabpanel" style="height: 400px;"></div>
        <div class="tab-pane fade graph-container" id="tab2" role="tabpanel" style="height: 400px;"></div>
        <div class="tab-pane fade graph-container" id="tab3" role="tabpanel" style="height: 400px;"></div>
        <div class="tab-pane fade graph-container" id="tab4" role="tabpanel" style="height: 400px;"></div>
        <div class="tab-pane fade graph-container" id="tab5" role="tabpanel" style="height: 400px;"></div>
        <div class="tab-pane fade graph-container" id="tab6" role="tabpanel" style="height: 400px;"></div>
        <div class="tab-pane fade graph-container" id="tab7" role="tabpanel" style="height: 400px;"></div>
        <div class="tab-pane fade graph-container" id="tab8" role="tabpanel" style="height: 400px;"></div>
      </div>
    </div>
  </div>
  
  <!-- Load Bootstrap JS and dependencies -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  
  <script>
    // Function to update graphs in both modes
    function updateGraphs() {
      fetch('/update_graphs')
        .then(response => response.json())
        .then(data => {
          const grouped = data.grouped_activation;
          // Update expanded mode graphs
          for (let i = 1; i <= 8; i++) {
            if (grouped[`group${i}`]) {
              const fig = JSON.parse(grouped[`group${i}`]);
              Plotly.react(`group${i}`, fig.data, fig.layout);
            }
          }
          // Update collapsed mode graphs (tabs)
          for (let i = 1; i <= 8; i++) {
            if (grouped[`group${i}`]) {
              const fig = JSON.parse(grouped[`group${i}`]);
              Plotly.react(`tab${i}`, fig.data, fig.layout);
            }
          }
        })
        .catch(error => console.error('Error fetching graph data:', error));
    }
    
    // Toggle between expanded and collapsed modes
    document.getElementById('toggleMode').addEventListener('click', function() {
      const expanded = document.getElementById('expanded-container');
      const collapsed = document.getElementById('collapsed-container');
      if (expanded.style.display !== 'none') {
        expanded.style.display = 'none';
        collapsed.style.display = 'block';
        this.textContent = 'Switch to Expanded Mode';
      } else {
        expanded.style.display = 'block';
        collapsed.style.display = 'none';
        this.textContent = 'Switch to Collapsed Mode';
      }
    });
    
    // Initial rendering of the graphs
    updateGraphs();
    // Refresh graphs periodically (every second, adjust as needed)
    setInterval(updateGraphs, 1000);
  </script>
</body>
</html>
