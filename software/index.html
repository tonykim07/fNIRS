<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Visualization</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div>
        <button id="btn-0" onclick="toggleEmitter(0)" style="margin: 5px; background-color: yellow;">Emitter 1</button>
        <button id="btn-1" onclick="toggleEmitter(1)" style="margin: 5px; background-color: yellow;">Emitter 2</button>
        <button id="btn-2" onclick="toggleEmitter(2)" style="margin: 5px; background-color: yellow;">Emitter 3</button>
        <button id="btn-3" onclick="toggleEmitter(3)" style="margin: 5px; background-color: yellow;">Emitter 4</button>
        <button id="btn-4" onclick="toggleEmitter(4)" style="margin: 5px; background-color: yellow;">Emitter 5</button>
        <button id="btn-5" onclick="toggleEmitter(5)" style="margin: 5px; background-color: yellow;">Emitter 6</button>
        <button id="btn-6" onclick="toggleEmitter(6)" style="margin: 5px; background-color: yellow;">Emitter 7</button>
        <button id="btn-7" onclick="toggleEmitter(7)" style="margin: 5px; background-color: yellow;">Emitter 8</button>
        <button id="btn-8" onclick="toggleEmitter(8)" style="margin: 5px; background-color: yellow;">Emitter 9</button>
        <button id="btn-9" onclick="toggleEmitter(9)" style="margin: 5px; background-color: yellow;">Emitter 10</button>
        <button id="btn-10" onclick="toggleEmitter(10)" style="margin: 5px; background-color: yellow;">Emitter 11</button>
        <button id="btn-11" onclick="toggleEmitter(11)" style="margin: 5px; background-color: yellow;">Emitter 12</button>
        <button id="btn-12" onclick="toggleEmitter(12)" style="margin: 5px; background-color: yellow;">Emitter 13</button>
        <button id="btn-13" onclick="toggleEmitter(13)" style="margin: 5px; background-color: yellow;">Emitter 14</button>
        <button id="btn-14" onclick="toggleEmitter(14)" style="margin: 5px; background-color: yellow;">Emitter 15</button>
        <button id="btn-15" onclick="toggleEmitter(15)" style="margin: 5px; background-color: yellow;">Emitter 16</button>
    </div>
    <div id="brain-mesh-graph" style="display: inline-block; width: 45%;"></div>
    <div id="stacked-activation-graph" style="display: inline-block; width: 45%;"></div>

    <script>
        let emitterStates = [true, true, true, true, true, true, true, true];

        function toggleEmitter(index) {
            emitterStates[index] = !emitterStates[index];
            updateEmitterStates();
            updateButtonStyles();
        }

        function updateEmitterStates() {
            $.ajax({
                url: '/update_emitter_states',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ emitter_states: emitterStates }),
                success: function(response) {
                    console.log('Emitter states updated:', response);
                }
            });
        }

        function updateButtonStyles() {
            for (let i = 0; i < emitterStates.length; i++) {
                const button = document.getElementById(`btn-${i}`);
                button.style.backgroundColor = emitterStates[i] ? 'yellow' : 'gray';
            }
        }

        function updateGraphs() {
            $.getJSON('/update_graphs', function(data) {
                console.log("Updating graphs with data:", data);
                if (data.brain_mesh && data.stacked_activation) {
                    Plotly.react('brain-mesh-graph', JSON.parse(data.brain_mesh).data, JSON.parse(data.brain_mesh).layout);
                    Plotly.react('stacked-activation-graph', JSON.parse(data.stacked_activation).data, JSON.parse(data.stacked_activation).layout);
                }
            });
        }

        setInterval(updateGraphs, 1000);  // Update every 1000ms
    </script>
</body>
</html>